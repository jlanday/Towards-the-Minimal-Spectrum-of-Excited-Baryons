(* ::Package:: *)

(* ::Title:: *)
(*Functional Definitions*)


(* ::Input:: *)
(*SetDirectory[NotebookDirectory[]];*)
(*Needs["ErrorBarPlots`"]*)
(**)
(*plotGrid[l_List,w_,h_,opts:OptionsPattern[]]:=Module[{nx,ny,sidePadding=OptionValue[plotGrid,ImagePadding],topPadding=0,widths,heights,dimensions,positions,frameOptions=FilterRules[{opts},FilterRules[Options[Graphics],Except[{ImagePadding,Frame,FrameTicks}]]]},{ny,nx}=Dimensions[l];*)
(*widths=(w-2 sidePadding)/nx Table[1,{nx}];*)
(*widths[[1]]=widths[[1]]+sidePadding;*)
(*widths[[-1]]=widths[[-1]]+sidePadding;*)
(*heights=(h-2 sidePadding)/ny Table[1,{ny}];*)
(*heights[[1]]=heights[[1]]+sidePadding;*)
(*heights[[-1]]=heights[[-1]]+sidePadding;*)
(*positions=Transpose@Partition[Tuples[Prepend[Accumulate[Most[#]],0]&/@{widths,heights}],ny];*)
(*Graphics[Table[Inset[Show[l[[ny-j+1,i]],ImagePadding->{{If[i==1,sidePadding,0],If[i==nx,sidePadding,0]},{If[j==1,sidePadding,0],If[j==ny,sidePadding,topPadding]}},AspectRatio->Full],positions[[j,i]],{Left,Bottom},{widths[[i]],heights[[j]]}],{i,1,nx},{j,1,ny}],PlotRange->{{0,w},{0,h}},ImageSize->{w,h},Evaluate@Apply[Sequence,frameOptions]]]*)
(*Options[plotGrid]={ImagePadding->60};*)
(**)
(*importdata[link_]:=Module[{rawdata,temp,cosdata,data},rawdata=Import[link,"Table"];cosdata=Select[Select[rawdata,Length[#]==3&],VectorQ[#,NumberQ]&];*)
(*data=Table[{ArcCos[cosdata[[i,1]]],cosdata[[i,2]],cosdata[[i,3]]},{i,1,Length[cosdata]}];*)
(*temp=Table[{},{i,1,rawdata[[1,1]]}];*)
(*For[i=1;j=1;,i<Length[data],If[data[[i+1,1]]>data[[i,1]],j++]*)
(*i++,AppendTo[temp[[j]],data[[i]]]]*)
(*AppendTo[temp[[j]],data[[i]]];*)
(*temp]*)
(**)
(*importenergy[link_]:=Module[{rawdata,temp,data},rawdata=Import[link,"Table"];data=Select[Select[rawdata,Length[#]==2&],VectorQ[#,NumberQ]&];*)
(*temp=Table[data[[i,2]],{i,1,Length[data]}];*)
(*temp];*)
(**)
(*plotter[data_,energy_,function_,fit_,label_,rows_,columns_,width_,height_]:=Monitor[Module[{temp,mins,maxes,plot},*)
(*temp=Table[If[4*i+j<=Length[data],Max[Flatten[data[[4*i+j]]]],0],{i,0,rows-1},{j,1,columns}];*)
(*maxes=1.2*Flatten[Table[Max[temp[[i]]],{i,0+1,rows},{j,1,columns}]];*)
(*temp=Table[If[4*i+j<=Length[data],Min[Flatten[data[[4*i+j]]]],0],{i,0,rows-1},{j,1,columns}];*)
(*mins=1.2*Flatten[Table[Min[temp[[i]]],{i,0+1,rows},{j,1,columns}]];*)
(*plot=Table[If[4*i+j>Length[data],Plot[0,{t,0,Pi},FrameLabel->{{label,label},{"\[Theta] [rad]","\[Theta] [rad]"}},PlotStyle->White,Frame->True,AspectRatio->1,Axes->False,FrameTicks->All,PlotRange->{{0,Pi},{mins[[4*i+j]]-4,maxes[[4*i+j]]}}],Show[ErrorListPlot[data[[4*i+j]],PlotRange->{{0,Pi},{mins[[4*i+j]]-4,maxes[[4*i+j]]}},Frame->True,AspectRatio->1,Epilog->Text[Style[energy[[i*4+j]]"MeV",FontSize->8],Scaled[{0.03,0.93}],{-1,0}],Axes->False,FrameTicks->All,FrameLabel->{{label,label},{"\[Theta] [rad]","\[Theta] [rad]"}}],ListPlot[Table[{\[Theta],function[energy[[4*i+j]],\[Theta]]/.fit[[2]]},{\[Theta],0,Pi,0.1}],Joined->True,PlotStyle->Red]]],{i,0,rows-1},{j,1,columns}];*)
(*plotGrid[plot,width,height]],ProgressIndicator[4*i+j,{1,4*(rows-1)+columns}]]*)
(**)
(*mpoleplot[fitresult_]:=Module[{plot1,plot2,plot3,plot4,plot5,plot6,plot7,plot8,plot9,plot10},plot1=Plot[{Re[S01half[W]]/.fitresult[[2]],Im[S01half[W]]/.fitresult[[2]]},{W,mK+mXi,3150},Frame->True,PlotRange->{{mK+mXi,3150},All},FrameLabel->{{"\!\(\*SubscriptBox[\(S\), \(01\)]\)","\!\(\*SubscriptBox[\(S\), \(01\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False,PlotRange->{{mK+mXi,3150},{-.09,.09}},FrameTicks->All];plot2=Plot[{Re[S11half[W]]/.fitresult[[2]],Im[S11half[W]]/.fitresult[[2]]},{W,mK+mXi,3265},Frame->True,PlotRange->{{mK+mXi,3265},All},FrameLabel->{{"\!\(\*SubscriptBox[\(S\), \(11\)]\)","\!\(\*SubscriptBox[\(S\), \(11\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False,FrameTicks->All];plot3=Plot[{Re[P01half[W]]/.fitresult[[2]],Im[P01half[W]]/.fitresult[[2]]},{W,mK+mXi,3150},Frame->True,PlotRange->{{mK+mXi,3150},All},FrameLabel->{{"\!\(\*SubscriptBox[\(P\), \(01\)]\)","\!\(\*SubscriptBox[\(P\), \(01\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False,FrameTicks->All];plot4=Plot[{Re[P11half[W]]/.fitresult[[2]],Im[P11half[W]]/.fitresult[[2]]},{W,mK+mXi,3265},Frame->True,PlotRange->{{mK+mXi,3265},All},FrameLabel->{{"\!\(\*SubscriptBox[\(P\), \(11\)]\)","\!\(\*SubscriptBox[\(P\), \(11\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False,FrameTicks->All];*)
(*plot5=Plot[{Re[P03half[W]]/.fitresult[[2]],Im[P03half[W]]/.fitresult[[2]]},{W,mK+mXi,3150},Frame->True,PlotRange->{{mK+mXi,3150},{-.09,.09}},FrameLabel->{{"\!\(\*SubscriptBox[\(P\), \(03\)]\)","\!\(\*SubscriptBox[\(P\), \(03\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False,FrameTicks->All];plot6=Plot[{Re[P13half[W]]/.fitresult[[2]],Im[P13half[W]]/.fitresult[[2]]},{W,mK+mXi,3265},Frame->True,PlotRange->{{mK+mXi,3265},All},FrameLabel->{{"\!\(\*SubscriptBox[\(P\), \(13\)]\)","\!\(\*SubscriptBox[\(P\), \(13\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False,FrameTicks->All];plot7=Plot[{Re[D03half[W]]/.fitresult[[2]],Im[D03half[W]]/.fitresult[[2]]},{W,mK+mXi,3150},Frame->True,PlotRange->{{mK+mXi,3150},All},FrameLabel->{{"\!\(\*SubscriptBox[\(D\), \(03\)]\)","\!\(\*SubscriptBox[\(D\), \(03\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False];plot8=Plot[{Re[D13half[W]]/.fitresult[[2]],Im[D13half[W]]/.fitresult[[2]]},{W,mK+mXi,3265},Frame->True,PlotRange->{{mK+mXi,3265},All},FrameLabel->{{"\!\(\*SubscriptBox[\(D\), \(13\)]\)","\!\(\*SubscriptBox[\(D\), \(13\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False,FrameTicks->All];*)
(*plot9=Plot[{Re[D05half[W]]/.fitresult[[2]],Im[D05half[W]]/.fitresult[[2]]},{W,mK+mXi,3150},Frame->True,PlotRange->{{mK+mXi,3150},All},FrameLabel->{{"\!\(\*SubscriptBox[\(D\), \(05\)]\)","\!\(\*SubscriptBox[\(D\), \(05\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False,FrameTicks->All];plot10=Plot[{Re[D15half[W]]/.fitresult[[2]],Im[D15half[W]]/.fitresult[[2]]},{W,mK+mXi,3265},Frame->True,PlotRange->{{mK+mXi,3265},All},FrameLabel->{{"\!\(\*SubscriptBox[\(D\), \(15\)]\)","\!\(\*SubscriptBox[\(D\), \(15\)]\)"},{"W [MeV]","W [MeV]"}},PlotStyle->{{Thick,Dashed},Thick},LabelStyle->12, AspectRatio->1,Axes->False,FrameTicks->All];plotGrid[{{plot1,plot2},{plot3,plot4},{plot5,plot6},{plot7,plot8},{plot9,plot10}},600,1000]];*)
(*mKp=493.677; (*mass of K^+*)*)
(*mKm=493.677;(*mass of K^-*)*)
(*mK0=497.648;(*mass of K^0*)*)
(*mK=(mKp+mKm+mK0)/3; *)
(*mXi0=1314.86; (*mass of \[CapitalXi]^0*)*)
(*mXim=1321.71;(*mass of \[CapitalXi]^-*)*)
(*mXi=(mXi0+mXim)/2; *)
(*mP=938.27; (* mass of proton *)*)
(*mN=939.565;(*mass of nuetron*)*)
(*factor=3.894*10^8;   (* unit conversion factor: ([MeV]^-2) to [\[Mu]barn] *)*)
(*\[CapitalLambda]=N[10^3]; (*1Gev=10^3Mev*)*)
(**)


(* ::Title:: *)
(*Data Import*)


(* ::Input:: *)
(*Cross1=Import["Cross1toy.m"];*)
(*Cross2=Import["Cross2toy.m"];*)
(*Diff1=Import["Diff1toy.m"];*)
(*Diff2=Import["Diff2toy.m"];*)
(*pol1=Import["P1toy.m"];*)
(*pol2=Import["P2toy.m"];*)
(*Diff1Energy=Table[W,{W,mKp+mXi+100,2800,28}];*)
(*Diff2Energy=Table[W,{W,mKp+mXi+100,2800,28}];*)
(*pol1Energy=Table[W,{W,mKp+mXi+100,2800,56}];*)
(*pol2Energy=Table[W,{W,mKp+mXi+100,2800,56}];*)


(* ::Title:: *)
(*Plots of data and their partial waves*)


(* ::Input:: *)
(*k[W_,m1_,m2_]:=1/(2*W) (\[Sqrt]((W^2-(m1-m2)^2)*(W^2-(m1+m2)^2)))*)
(*kf[W_]=k[W,mK,mXi];*)
(*ki[W_]=k[W,mK,mP];*)
(*jmax=5/2;*)
(*ons=1;*)
(*onp=1;*)
(*ond=1;*)
(*nopars=6*ons+12*onp+12*ond;*)
(*num=If[nopars==6,1,If[nopars==18,5,9]];*)
(*pars=Flatten[Join[Table[{s[i],\[Alpha][i]},{i,0,num}],Table[{\[Phi][i]},{i,0,num-1}]]];*)
(**)
(*S01half[W_]:=ons*(((s[0]+ss[0]/10 kf[W]/\[CapitalLambda])Exp[-\[Alpha][0]^2*kf[W]^2/\[CapitalLambda]^2]-x[0]Exp[I*ph[0]] \[CapitalGamma][0]/(2(W-M[0]+I \[CapitalGamma][0]/2)))Exp[I*\[Phi][0]])*(kf[W]/\[CapitalLambda])^(0+1/2)*)
(*S11half[W_]:=ons*((s[1]+ss[1]/10 kf[W]/\[CapitalLambda])Exp[I*\[Phi][1]])*(kf[W]/\[CapitalLambda])^(0+1/2) Exp[-\[Alpha][1]^2*kf[W]^2/\[CapitalLambda]^2]*)
(*P01half[W_]:=onp*((s[2]+ss[2]/10 kf[W]/\[CapitalLambda])Exp[I*\[Phi][2]])*(kf[W]/\[CapitalLambda])^(1+1/2) Exp[-\[Alpha][2]^2*kf[W]^2/\[CapitalLambda]^2]*)
(*P03half[W_]:=onp*((s[3]+ss[3]/10 kf[W]/\[CapitalLambda])Exp[I*\[Phi][3]])*(kf[W]/\[CapitalLambda])^(1+1/2) Exp[-\[Alpha][3]^2*kf[W]^2/\[CapitalLambda]^2]*)
(*P11half[W_]:=onp*(((s[4]+ss[4]/10 kf[W]/\[CapitalLambda])Exp[-\[Alpha][4]^2*kf[W]^2/\[CapitalLambda]^2]-x[4]Exp[I*ph[4]] \[CapitalGamma][4]/(2(W-M[4]+I \[CapitalGamma][4]/2)))Exp[I*\[Phi][4]])*(kf[W]/\[CapitalLambda])^(1+1/2)*)
(*P13half[W_]:=onp*((s[5]+ss[5]/10 kf[W]/\[CapitalLambda])Exp[I*\[Phi][5]])*(kf[W]/\[CapitalLambda])^(1+1/2) Exp[-\[Alpha][5]^2*kf[W]^2/\[CapitalLambda]^2]*)
(*D03half[W_]:=ond*((s[6]+ss[6]/10 kf[W]/\[CapitalLambda])Exp[I*\[Phi][6]])*(kf[W]/\[CapitalLambda])^(2+1/2) Exp[-\[Alpha][6]^2*kf[W]^2/\[CapitalLambda]^2]*)
(*D05half[W_]:=ond*(((s[7]+ss[7]/10 kf[W]/\[CapitalLambda])Exp[-\[Alpha][7]^2*kf[W]^2/\[CapitalLambda]^2]-x[7]Exp[I*ph[7]] \[CapitalGamma][7]/(2(W-M[7]+I \[CapitalGamma][7]/2)))Exp[I*\[Phi][7]])*(kf[W]/\[CapitalLambda])^(2+1/2)*)
(*D13half[W_]:=ond*((s[8]+ss[8]/10 kf[W]/\[CapitalLambda])Exp[I*\[Phi][8]])(kf[W]/\[CapitalLambda])^(2+1/2) Exp[-\[Alpha][8]^2*kf[W]^2/\[CapitalLambda]^2]*)
(*D15half[W_]:=ond*(((s[9]+ss[9]/10 kf[W]/\[CapitalLambda])Exp[-\[Alpha][9]^2*kf[W]^2/\[CapitalLambda]^2]-x[9]Exp[I*ph[9]] \[CapitalGamma][9]/(2(W-M[9]+I \[CapitalGamma][9]/2)))Exp[I*\[Phi][9]])*(kf[W]/\[CapitalLambda])^(2+1/2)/.{\[Phi][9]->0}*)
(*Subscript[\[Tau]0, -1/2]={S01half[W],P03half[W],D05half[W]};*)
(*Subscript[\[Tau]0, +1/2]={P01half[W],D03half[W],0};*)
(*Subscript[\[Tau]1, -1/2]={S11half[W],P13half[W],D15half[W]};*)
(*Subscript[\[Tau]1, +1/2]={P11half[W],D13half[W],0};*)
(*g0[\[Theta]_,W_]=1/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]0, -1/2][[J+1/2]]+Subscript[\[Tau]0, +1/2][[J+1/2]])Cos[\[Theta]/2]+WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]0, -1/2][[J+1/2]]-Subscript[\[Tau]0, +1/2][[J+1/2]])Sin[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*h0[\[Theta]_,W_]=-I/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]0, -1/2][[J+1/2]]+Subscript[\[Tau]0, +1/2][[J+1/2]])Sin[\[Theta]/2]-WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]0, -1/2][[J+1/2]]-Subscript[\[Tau]0, +1/2][[J+1/2]])Cos[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*g1[\[Theta]_,W_]=1/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]1, -1/2][[J+1/2]]+Subscript[\[Tau]1, +1/2][[J+1/2]])Cos[\[Theta]/2]+WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]1, -1/2][[J+1/2]]-Subscript[\[Tau]1, +1/2][[J+1/2]])Sin[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*h1[\[Theta]_,W_]=-I/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]1, -1/2][[J+1/2]]+Subscript[\[Tau]1, +1/2][[J+1/2]])Sin[\[Theta]/2]-WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]1, -1/2][[J+1/2]]-Subscript[\[Tau]1, +1/2][[J+1/2]])Cos[\[Theta]/2]),{J,1/2,jmax,1}];*)
(**)
(**)
(*gre1[\[Theta]_,W_]:=-1/2 g1[\[Theta],W]+1/2 g0[\[Theta],W](*<\[CapitalXi]^-k^+| p K^- *)*)
(*hre1[\[Theta]_,W_]:=-1/2 h1[\[Theta],W]+1/2 h0[\[Theta],W] (*<\[CapitalXi]^-k^+| p K^- *)*)
(**)
(*gre2[\[Theta]_,W_]:=-1/2 g1[\[Theta],W]-1/2 g0[\[Theta],W](*<\[CapitalXi]^0k^0| p K^- *)*)
(*hre2[\[Theta]_,W_]:=-1/2 h1[\[Theta],W]-1/2 h0[\[Theta],W] (*<\[CapitalXi]^0k^0| p K^- *)*)
(**)
(**)
(*d\[Sigma]d\[CapitalOmega]1[W_,\[Theta]_]:=factor*(Conjugate[gre1[\[Theta],W]]gre1[\[Theta],W]+Conjugate[hre1[\[Theta],W]]*hre1[\[Theta],W])*kf[W]/ki[W](*<\[CapitalXi]^-k^+| p K^- *)*)
(*P1[W_,\[Theta]_]:=(2Re[gre1[\[Theta],W]*Conjugate[hre1[\[Theta],W]]])/(Abs[gre1[\[Theta],W]]^2+Abs[hre1[\[Theta],W]]^2)*d\[Sigma]d\[CapitalOmega]1[W,\[Theta]](*<\[CapitalXi]^-k^+| p K^- *)*)
(**)
(**)
(*d\[Sigma]d\[CapitalOmega]2[W_,\[Theta]_]:=factor*(Conjugate[gre2[\[Theta],W]]gre2[\[Theta],W]+Conjugate[hre2[\[Theta],W]]*hre2[\[Theta],W])*kf[W]/ki[W](*<\[CapitalXi]^0k^0| p K^- *)*)
(*P2[W_,\[Theta]_]:=(2Re[gre2[\[Theta],W]*Conjugate[hre2[\[Theta],W]]])/(Abs[gre2[\[Theta],W]]^2+Abs[hre2[\[Theta],W]]^2)*d\[Sigma]d\[CapitalOmega]2[W,\[Theta]](*<\[CapitalXi]^0k^0| p K^- *)*)
(*\[Sigma]1[W_]=factor*1/2*(4Pi)/ki[W]^2 Sum[(2J+1) (Abs[-1/2 (Subscript[\[Tau]1, -1/2][[J+1/2]])+1/2 (Subscript[\[Tau]0, -1/2][[J+1/2]])]^2+ Abs[-1/2 (Subscript[\[Tau]1, 1/2][[J+1/2]])+1/2 (Subscript[\[Tau]0, 1/2][[J+1/2]])]^2),{J,1/2,jmax,1}];*)
(*\[Sigma]2[W_]=factor*1/2*(4Pi)/ki[W]^2 Sum[(2J+1) (Abs[-1/2 (Subscript[\[Tau]1, -1/2][[J+1/2]])-1/2 (Subscript[\[Tau]0, -1/2][[J+1/2]])]^2+ Abs[-1/2 (Subscript[\[Tau]1, 1/2][[J+1/2]])-1/2 (Subscript[\[Tau]0, 1/2][[J+1/2]])]^2),{J,1/2,jmax,1}];*)


(* ::Input:: *)
(**)
(*Fitresults={s[0]->-0.34824198024328586`,\[Alpha][0]->3.763438455711533`,s[1]->-0.4153619899748145`,\[Alpha][1]->-1.6504395877254527`,s[2]->0.20791938959137438`,\[Alpha][2]->1.932359556897292`,s[3]->0.3140263682123946`,\[Alpha][3]->1.4353226934402328`,s[4]->-0.09335240870654254`,\[Alpha][4]->1.2586482592270365`,s[5]->0.19804403841470758`,\[Alpha][5]->1.5543752980111297`,s[6]->0.08564949843750701`,\[Alpha][6]->0.8114266359183674`,s[7]->1.8696909108351594`,\[Alpha][7]->2.38042861587167`,s[8]->1.6784049993618166`,\[Alpha][8]->2.3546081341506007`,s[9]->-0.4910616507553648`,\[Alpha][9]->1.976612736930773`,\[Phi][0]->-1.3759095905974634`,\[Phi][1]->-.8628696533673115`,\[Phi][2]->-2.4292106595489664`,\[Phi][3]->-3.7601064302536518`,\[Phi][4]->-3.5505168556001405`,\[Phi][5]->0.6146668029672369`,\[Phi][6]->0.37669927068590553`,\[Phi][7]->-6.818425121493386`,\[Phi][8]->0.6225800989122515`,ss[0]->2,ss[1]->2,ss[2]->2,ss[3]->1/2,ss[4]->2,ss[5]->2,ss[6]->2,ss[7]->2,ss[8]->2,ss[9]->2,x[0]->.5,\[CapitalGamma][0]->100,M[0]->2036.962`,ph[0]->-.9,x[4]->.5,\[CapitalGamma][4]->160,M[4]->2191.96,ph[4]->-.8,x[7]->.5,\[CapitalGamma][7]->60,M[7]->2786.962`,ph[7]->-.7,x[9]->.5,\[CapitalGamma][9]->200,M[9]->2603.962`,ph[9]->-.5};*)
(*Options[plotGrid]={ImagePadding->62};*)
(*generator=mpoleplot[{1,Fitresults}]*)


(* ::Input:: *)
(*fig1=plotter[Diff1,Diff1Energy,d\[Sigma]d\[CapitalOmega]1,{1,Fitresults},"\!\(\*FractionBox[\(d\[Sigma]\), \(d\[CapitalOmega]\)]\)[\[Mu]b/sr]",8,4,850,2*650]*)
(*fig2=plotter[Diff2,Diff2Energy,d\[Sigma]d\[CapitalOmega]2,{1,Fitresults},"\!\(\*FractionBox[\(d\[Sigma]\), \(d\[CapitalOmega]\)]\)[\[Mu]b/sr]",8,4,850,2*650]*)
(*fig3=plotter[pol1,pol1Energy,P1,{1,Fitresults},"\!\(\*FractionBox[\(d\[Sigma]\), \(d\[CapitalOmega]\)]\)[\[Mu]b/sr]",4,4,850,2*550]*)
(*fig4=plotter[pol2,pol2Energy,P2,{1,Fitresults},"\!\(\*FractionBox[\(d\[Sigma]\), \(d\[CapitalOmega]\)]\)[\[Mu]b/sr]",4,4,850,2*550]*)
(*fig5=Show[ErrorListPlot[Cross1,Frame->True,FrameLabel->{"Energy [MeV]","\[Sigma][\[Mu]b]"}],Plot[\[Sigma]1[W]/.Fitresults,{W,mK+mXi,3229},PlotStyle->Red,PlotRange->{{mK+mXi,3229},All},LabelStyle->12]]*)
(*fig6=Show[ErrorListPlot[Cross2,Frame->True,FrameLabel->{"Energy [MeV]","\[Sigma][\[Mu]b]"}],Plot[\[Sigma]2[W]/.Fitresults,{W,mK+mXi,3229},PlotStyle->Red,PlotRange->{{mK+mXi,3229},All},LabelStyle->12]]*)


(* ::Input:: *)
(*fig5=Show[ErrorListPlot[Cross1,Frame->True,FrameLabel->{"Energy [MeV]","\[Sigma][\[Mu]b]"},LabelStyle->12,PlotRange->{{mK+mXi,3190},{0,1250}}],Plot[\[Sigma]1[W]/.Fitresults,{W,mK+mXi,3229},PlotStyle->{Red,Thick},PlotRange->{{mK+mXi,3190},All},LabelStyle->12]];*)


(* ::Input:: *)
(*hm=ListPlot[{Table[{2036.96,i},{i,0,1300,100}],Table[{2191.96,i},{i,0,1300,100}],Table[{2786.96,i},{i,0,1300,100}],Table[{2603.96,i},{i,0,1300,100}]},Joined->True,PlotStyle->Black];*)


(* ::Input:: *)
(*fig5=Show[ErrorListPlot[Cross1,Frame->True,FrameLabel->{"Energy [MeV]","\[Sigma][\[Mu]b]"},LabelStyle->12,PlotRange->{{mK+mXi,3190},{0,1250}}],Plot[\[Sigma]1[W]/.Fitresults,{W,mK+mXi,3229},PlotStyle->{Red,Thick},PlotRange->{{mK+mXi,3190},All},LabelStyle->14],hm];*)
(*fig6=Show[ErrorListPlot[Cross2,Frame->True,FrameLabel->{"Energy [MeV]","\[Sigma][\[Mu]b]"},PlotRange->{{mK+mXi,3200},{0,1250}},LabelStyle->14,FrameTicks->{{None,All},{All,None}}],Plot[\[Sigma]2[W]/.Fitresults,{W,mK+mXi,3229},PlotStyle->{Red,Thick},PlotRange->{{mK+mXi,3200},{0,1250}},LabelStyle->14],hm]*)


(* ::Input:: *)
(*plotGrid[{{fig5,fig6}},1.5*700,1.5*300]*)


(* ::Title:: *)
(*LASSO*)


(* ::Subsection:: *)
(*First we run from larger to smaller lambdas*)


(* ::Input:: *)
(*k[W_,m1_,m2_]:=1/(2*W) (\[Sqrt]((W^2-(m1-m2)^2)*(W^2-(m1+m2)^2)))*)
(*kf[W_]=k[W,mK,mXi];*)
(*ki[W_]=k[W,mK,mP];*)
(*jmax=5/2;*)
(*ons=1;*)
(*onp=1;*)
(*ond=1;*)
(*nopars=6*ons+12*onp+12*ond;*)
(*num=If[nopars==6,1,If[nopars==18,5,9]];*)
(*pars=Flatten[Join[Table[{s[i],\[Alpha][i]},{i,0,num}],Table[{\[Phi][i]},{i,0,num-1}]]];*)
(*S01half[W_]:=ons*((s[0]Exp[-\[Alpha][0]^2*kf[W]^2/\[CapitalLambda]^2]-x[0]Exp[I*ph[0]] \[CapitalGamma][0]/(2(W-M[0]+I \[CapitalGamma][0]/2)))Exp[I*\[Phi][0]])*(kf[W]/\[CapitalLambda])^(0+1/2)*)
(*S11half[W_]:=ons*((s[1]Exp[-\[Alpha][1]^2*kf[W]^2/\[CapitalLambda]^2]-x[1]Exp[I*ph[1]] \[CapitalGamma][1]/(2(W-M[1]+I \[CapitalGamma][1]/2)))Exp[I*\[Phi][1]])*(kf[W]/\[CapitalLambda])^(0+1/2)*)
(*P01half[W_]:=onp*((s[2]Exp[-\[Alpha][2]^2*kf[W]^2/\[CapitalLambda]^2]-x[2]Exp[I*ph[2]] \[CapitalGamma][2]/(2(W-M[2]+I \[CapitalGamma][2]/2)))Exp[I*\[Phi][2]])*(kf[W]/\[CapitalLambda])^(1+1/2)*)
(*P03half[W_]:=onp*((s[3]Exp[-\[Alpha][3]^2*kf[W]^2/\[CapitalLambda]^2]-x[3]Exp[I*ph[3]] \[CapitalGamma][3]/(2(W-M[3]+I \[CapitalGamma][3]/2)))Exp[I*\[Phi][3]])*(kf[W]/\[CapitalLambda])^(1+1/2)*)
(*P11half[W_]:=onp*((s[4]Exp[-\[Alpha][4]^2*kf[W]^2/\[CapitalLambda]^2]-x[4]Exp[I*ph[4]] \[CapitalGamma][4]/(2(W-M[4]+I \[CapitalGamma][4]/2)))Exp[I*\[Phi][4]])*(kf[W]/\[CapitalLambda])^(1+1/2)*)
(*P13half[W_]:=onp*((s[5]Exp[-\[Alpha][5]^2*kf[W]^2/\[CapitalLambda]^2]-x[5]Exp[I*ph[5]] \[CapitalGamma][5]/(2(W-M[5]+I \[CapitalGamma][5]/2)))Exp[I*\[Phi][5]])*(kf[W]/\[CapitalLambda])^(1+1/2)*)
(*D03half[W_]:=ond*((s[6]Exp[-\[Alpha][6]^2*kf[W]^2/\[CapitalLambda]^2]-x[6]Exp[I*ph[6]] \[CapitalGamma][6]/(2(W-M[6]+I \[CapitalGamma][6]/2)))Exp[I*\[Phi][6]])*(kf[W]/\[CapitalLambda])^(2+1/2)*)
(*D05half[W_]:=ond*((s[7]Exp[-\[Alpha][7]^2*kf[W]^2/\[CapitalLambda]^2]-x[7]Exp[I*ph[7]] \[CapitalGamma][7]/(2(W-M[7]+I \[CapitalGamma][7]/2)))Exp[I*\[Phi][7]])*(kf[W]/\[CapitalLambda])^(2+1/2)*)
(*D13half[W_]:=ond*((s[8]Exp[-\[Alpha][8]^2*kf[W]^2/\[CapitalLambda]^2]-x[8]Exp[I*ph[8]] \[CapitalGamma][8]/(2(W-M[8]+I \[CapitalGamma][8]/2)))Exp[I*\[Phi][8]])*(kf[W]/\[CapitalLambda])^(2+1/2)*)
(*D15half[W_]:=ond*((s[9]Exp[-\[Alpha][9]^2*kf[W]^2/\[CapitalLambda]^2]-x[9]Exp[I*ph[9]] \[CapitalGamma][9]/(2(W-M[9]+I \[CapitalGamma][9]/2)))Exp[I*0])*(kf[W]/\[CapitalLambda])^(2+1/2)*)
(*Subscript[\[Tau]0, -1/2]={S01half[W],P03half[W],D05half[W]};*)
(*Subscript[\[Tau]0, +1/2]={P01half[W],D03half[W],0};*)
(*Subscript[\[Tau]1, -1/2]={S11half[W],P13half[W],D15half[W]};*)
(*Subscript[\[Tau]1, +1/2]={P11half[W],D13half[W],0};*)
(*g0[\[Theta]_,W_]=1/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]0, -1/2][[J+1/2]]+Subscript[\[Tau]0, +1/2][[J+1/2]])Cos[\[Theta]/2]+WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]0, -1/2][[J+1/2]]-Subscript[\[Tau]0, +1/2][[J+1/2]])Sin[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*h0[\[Theta]_,W_]=-I/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]0, -1/2][[J+1/2]]+Subscript[\[Tau]0, +1/2][[J+1/2]])Sin[\[Theta]/2]-WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]0, -1/2][[J+1/2]]-Subscript[\[Tau]0, +1/2][[J+1/2]])Cos[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*g1[\[Theta]_,W_]=1/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]1, -1/2][[J+1/2]]+Subscript[\[Tau]1, +1/2][[J+1/2]])Cos[\[Theta]/2]+WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]1, -1/2][[J+1/2]]-Subscript[\[Tau]1, +1/2][[J+1/2]])Sin[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*h1[\[Theta]_,W_]=-I/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]1, -1/2][[J+1/2]]+Subscript[\[Tau]1, +1/2][[J+1/2]])Sin[\[Theta]/2]-WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]1, -1/2][[J+1/2]]-Subscript[\[Tau]1, +1/2][[J+1/2]])Cos[\[Theta]/2]),{J,1/2,jmax,1}];*)
(**)
(**)
(*gre1[\[Theta]_,W_]:=-1/2 g1[\[Theta],W]+1/2 g0[\[Theta],W](*<\[CapitalXi]^-k^+| p K^- *)*)
(*hre1[\[Theta]_,W_]:=-1/2 h1[\[Theta],W]+1/2 h0[\[Theta],W] (*<\[CapitalXi]^-k^+| p K^- *)*)
(**)
(*gre2[\[Theta]_,W_]:=-1/2 g1[\[Theta],W]-1/2 g0[\[Theta],W](*<\[CapitalXi]^0k^0| p K^- *)*)
(*hre2[\[Theta]_,W_]:=-1/2 h1[\[Theta],W]-1/2 h0[\[Theta],W] (*<\[CapitalXi]^0k^0| p K^- *)*)
(**)
(**)
(*d\[Sigma]d\[CapitalOmega]1[W_,\[Theta]_]:=factor*(Conjugate[gre1[\[Theta],W]]gre1[\[Theta],W]+Conjugate[hre1[\[Theta],W]]*hre1[\[Theta],W])*kf[W]/ki[W](*<\[CapitalXi]^-k^+| p K^- *)*)
(*P1[W_,\[Theta]_]:=(2Re[gre1[\[Theta],W]*Conjugate[hre1[\[Theta],W]]])/(Abs[gre1[\[Theta],W]]^2+Abs[hre1[\[Theta],W]]^2)*d\[Sigma]d\[CapitalOmega]1[W,\[Theta]](*<\[CapitalXi]^-k^+| p K^- *)*)
(**)
(**)
(*d\[Sigma]d\[CapitalOmega]2[W_,\[Theta]_]:=factor*(Conjugate[gre2[\[Theta],W]]gre2[\[Theta],W]+Conjugate[hre2[\[Theta],W]]*hre2[\[Theta],W])*kf[W]/ki[W](*<\[CapitalXi]^0k^0| p K^- *)*)
(*P2[W_,\[Theta]_]:=(2Re[gre2[\[Theta],W]*Conjugate[hre2[\[Theta],W]]])/(Abs[gre2[\[Theta],W]]^2+Abs[hre2[\[Theta],W]]^2)*d\[Sigma]d\[CapitalOmega]2[W,\[Theta]](*<\[CapitalXi]^0k^0| p K^- *)*)
(*\[Sigma]1[W_]=factor*1/2*(4Pi)/ki[W]^2 Sum[(2J+1) (Abs[-1/2 (Subscript[\[Tau]1, -1/2][[J+1/2]])+1/2 (Subscript[\[Tau]0, -1/2][[J+1/2]])]^2+ Abs[-1/2 (Subscript[\[Tau]1, 1/2][[J+1/2]])+1/2 (Subscript[\[Tau]0, 1/2][[J+1/2]])]^2),{J,1/2,jmax,1}];*)
(*\[Sigma]2[W_]=factor*1/2*(4Pi)/ki[W]^2 Sum[(2J+1) (Abs[-1/2 (Subscript[\[Tau]1, -1/2][[J+1/2]])-1/2 (Subscript[\[Tau]0, -1/2][[J+1/2]])]^2+ Abs[-1/2 (Subscript[\[Tau]1, 1/2][[J+1/2]])-1/2 (Subscript[\[Tau]0, 1/2][[J+1/2]])]^2),{J,1/2,jmax,1}];*)


(* ::Input:: *)
(*Chisq[\[Lambda]_]:=Sum[(1/Diff2[[i,j,3]])^2*(d\[Sigma]d\[CapitalOmega]2[Diff2Energy[[i]],Diff2[[i,j,1]]]-Diff2[[i,j,2]])^2,{i,1,Length[Diff2]},{j,1,Length[Diff2[[i]]]}]+Sum[(1/Diff1[[i,j,3]])^2*(d\[Sigma]d\[CapitalOmega]1[Diff1Energy[[i]],Diff1[[i,j,1]]]-Diff1[[i,j,2]])^2,{i,1,Length[Diff1]},{j,1,Length[Diff1[[i]]]}]+Sum[(1/Cross1[[i,3]])^2*(\[Sigma]1[Cross1[[i,1]]]-Cross1[[i,2]])^2,{i,1,Length[Cross1]}]+Sum[(1/Cross2[[i,3]])^2*(\[Sigma]2[Cross2[[i,1]]]-Cross2[[i,2]])^2,{i,1,Length[Cross2]}]+Sum[(1/pol1[[i,j,3]])^2*(P1[pol1Energy[[i]],pol1[[i,j,1]]]-pol1[[i,j,2]])^2,{i,1,Length[pol1]},{j,1,Length[pol1[[i]]]}]+Sum[(1/pol2[[i,j,3]])^2*(P2[pol2Energy[[i]],pol2[[i,j,1]]]-pol2[[i,j,2]])^2,{i,1,Length[pol2]},{j,1,Length[pol2[[i]]]}]+\[Lambda]^4 (Abs[x[9]]+Abs[x[8]]+Abs[x[7]]+Abs[x[6]]+Abs[x[5]]+Abs[x[4]]+Abs[x[3]]+Abs[x[2]]+Abs[x[1]]+Abs[x[0]])*)


(* ::Input:: *)
(*guess={{s[0],-0.34824198024328584`},{\[Alpha][0],3.763438455711533`},{s[1],-0.07153619899748145`},{\[Alpha][1],-0.5504395877254527`},{s[2],0.20791938959137438`},{\[Alpha][2],1.932359556897292`},{s[3],0.3140263682123946`},{\[Alpha][3],1.4353226934402328`},{s[4],-0.09335240870654254`},{\[Alpha][4],1.2586482592270365`},{s[5],0.19804403841470758`},{\[Alpha][5],1.1543752980111297`},{s[6],0.08564949843750701`},{\[Alpha][6],0.8114266359183674`},{s[7],1.8696909108351594`},{\[Alpha][7],2.38042861587167`},{s[8],1.6784049993618166`},{\[Alpha][8],2.3546081341506007`},{s[9],-0.4910616507553648`},{\[Alpha][9],1.976612736930773`},{\[Phi][0],-1.3759095905974634`},{\[Phi][1],-1.8628696533673115`},{\[Phi][2],-2.4292106595489664`},{\[Phi][3],-3.7601064302536518`},{\[Phi][4],-3.5505168556001405`},{\[Phi][5],-0.6146668029672369`},{\[Phi][6],0.37669927068590553`},{\[Phi][7],-6.818425121493386`},{\[Phi][8],0.6225800989122515`},{x[0],0.5},{\[CapitalGamma][0],100},{M[0],2036.96},{ph[0],-.9},{x[1],.25},{\[CapitalGamma][1],100},{M[1],2000},{ph[1],-1.2},{x[2],.25},{\[CapitalGamma][2],100},{M[2],2000},{ph[2],-1},{x[3],.25},{\[CapitalGamma][3],100},{M[3],2000},{ph[3],-1},{x[4],0.5},{\[CapitalGamma][4],160},{M[4],2191.96},{ph[4],-.8},{x[5],.25},{\[CapitalGamma][5],100},{M[5],2000},{ph[5],-.2131},{x[6],.25},{\[CapitalGamma][6],100},{M[6],2000},{ph[6],-.121},{x[7],0.5},{\[CapitalGamma][7],60},{M[7],2786.962`},{ph[7],-.7},{x[8],.25},{\[CapitalGamma][8],100},{M[8],2000},{ph[8],-1},{x[9],0.5},{\[CapitalGamma][9],81},{M[9],2603.962`},{ph[9],-0.6}};*)


(* ::Input:: *)
(*chilist={};*)
(*chinoplist={};*)
(*palist={};*)
(*nopalist={};*)
(*Do[*)
(*fitresults=FindMinimum[Re[Chisq[\[Lambda]]],guess,MaxIterations->2000]//Quiet;*)
(*chisqwp=Re[fitresults[[1]]];*)
(*pars=fitresults[[2]];*)
(*chisq=Re[Chisq[0]]/.pars;*)
(*AppendTo[chilist,{\[Lambda],chisqwp}];*)
(*AppendTo[chinoplist,{\[Lambda],chisq}];*)
(*guess=Table[{pars[[i,1]],pars[[i,2]]},{i,1,Length[pars]}];*)
(*kkcount=0;*)
(*Do[If[Abs[pars[[i,2]]]<10^-3,kkcount=kkcount+1],{i,1,Length[guess]}];*)
(*AppendTo[nopalist,{\[Lambda],Length[guess]-4kkcount}];*)
(*AppendTo[palist,{\[Lambda],pars[[;;,2]]}];*)
(*Print[\[Lambda]];,{\[Lambda],10,0,-0.5}]*)


(* ::Input:: *)
(*nodat=Length[Cross1]+Length[Cross2]+Sum[Length[Diff1[[i]]],{i,1,Length[Diff1]}]+Sum[Length[Diff2[[i]]],{i,1,Length[Diff2]}]+Sum[Length[pol1[[i]]],{i,1,Length[pol1]}]+Sum[Length[pol2[[i]]],{i,1,Length[pol2]}];*)
(*dataPar= Table[{palist[[i,1]],Abs[palist[[i,2,j]]]},{j,1,Length[palist[[1,2]]]},{i,1,Length[palist]}];*)
(*chisq=chinoplist;*)
(*chidof=Table[{chisq[[i,1]],chisq[[i,2]]/(nodat-nopalist[[i,2]])},{i,1,Length[chisq]}];*)
(*aic=Table[{chisq[[i,1]],2nopalist[[i,2]]+nodat*Log[2Pi]+chisq[[i,2]]},{i,1,Length[chisq]}];*)
(*aicc=Table[{chisq[[i,1]],2nopalist[[i,2]]+nodat*Log[2Pi]+chisq[[i,2]]+2*nopalist[[i,2]]*(nopalist[[i,2]]+1)/(nodat-nopalist[[i,2]]-1)},{i,1,Length[chisq]}];*)
(*bic=Table[{chisq[[i,1]],nodat*Log[2Pi]+chisq[[i,2]]+nopalist[[i,2]]Log[nodat]},{i,1,Length[chisq]}];*)
(**)
(*respalist=Table[{palist[[i,1]],Flatten[Table[palist[[i,2,30+4j]],{j,0,9}]]},{i,1,Length[palist]}];*)
(*respar= Table[{respalist[[i,1]],Abs[respalist[[i,2,j]]]},{j,1,Length[respalist[[1,2]]]},{i,1,Length[respalist]}];*)


(* ::Input:: *)
(*plot1=Show[ListLogPlot[{chidof,chitestdof},LabelStyle->12,Joined->True,PlotRange->{{0,8},{0.95,2}},Frame->True,FrameLabel->{"\[Lambda]","\!\(\*SuperscriptBox[\(\[Chi]\), \(2\)]\)/d.o.f."}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-1,10000,1000}],Joined->True,PlotStyle->{Thick,Black}],Epilog->Text[Style["(a)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}]];*)
(*plot2=Show[ListLogPlot[respar,LabelStyle->12,Joined->True,Frame->True,PlotRange->{{0,8},{10,10^-9}},FrameLabel->{"\[Lambda]","x"},PlotStyle->Table[If[Abs[respalist[[Position[bic,Min[bic[[All,2]]]][[1,1]],2,i]]]>10^-3,Darker[Red],Gray],{i,1,Length[respalist[[5,2]]]}],Epilog->Text[Style["(b)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}]],LogPlot[10^-3,{x,0,8},PlotStyle->{Thick,Black}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-100,10,1}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plot3=Show[ListLogPlot[bic,LabelStyle->12,Epilog->Text[Style["(c)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}],PlotRange->{{0,8},{6000,7599}},Frame->True,Joined->True,FrameLabel->{"\[Lambda]","BIC"}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-1,10000,1000}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plotGrid[{{plot1},{plot2},{plot3}},400,4/3*500]*)
(**)


(* ::Subsubsection:: *)
(**)


(* ::Subsection:: *)
(*Now we will re run LASSO from small lambdas to large lambdas*)


(* ::Input:: *)
(*guess={{s[0],-0.34824198024328584`},{\[Alpha][0],3.763438455711533`},{s[1],-0.07153619899748145`},{\[Alpha][1],-0.5504395877254527`},{s[2],0.20791938959137438`},{\[Alpha][2],1.932359556897292`},{s[3],0.3140263682123946`},{\[Alpha][3],1.4353226934402328`},{s[4],-0.09335240870654254`},{\[Alpha][4],1.2586482592270365`},{s[5],0.19804403841470758`},{\[Alpha][5],1.1543752980111297`},{s[6],0.08564949843750701`},{\[Alpha][6],0.8114266359183674`},{s[7],1.8696909108351594`},{\[Alpha][7],2.38042861587167`},{s[8],1.6784049993618166`},{\[Alpha][8],2.3546081341506007`},{s[9],-0.4910616507553648`},{\[Alpha][9],1.976612736930773`},{\[Phi][0],-1.3759095905974634`},{\[Phi][1],-1.8628696533673115`},{\[Phi][2],-2.4292106595489664`},{\[Phi][3],-3.7601064302536518`},{\[Phi][4],-3.5505168556001405`},{\[Phi][5],-0.6146668029672369`},{\[Phi][6],0.37669927068590553`},{\[Phi][7],-6.818425121493386`},{\[Phi][8],0.6225800989122515`},{x[0],0.5},{\[CapitalGamma][0],100},{M[0],2036.96},{ph[0],-.9},{x[1],.25},{\[CapitalGamma][1],100},{M[1],2000},{ph[1],-1.2},{x[2],.25},{\[CapitalGamma][2],100},{M[2],2000},{ph[2],-1},{x[3],.25},{\[CapitalGamma][3],100},{M[3],2000},{ph[3],-1},{x[4],0.5},{\[CapitalGamma][4],160},{M[4],2191.96},{ph[4],-.8},{x[5],.25},{\[CapitalGamma][5],100},{M[5],2000},{ph[5],-.2131},{x[6],.25},{\[CapitalGamma][6],100},{M[6],2000},{ph[6],-.121},{x[7],0.5},{\[CapitalGamma][7],60},{M[7],2786.962`},{ph[7],-.7},{x[8],.25},{\[CapitalGamma][8],100},{M[8],2000},{ph[8],-1},{x[9],0.5},{\[CapitalGamma][9],81},{M[9],2603.962`},{ph[9],-0.6}};*)


(* ::Input:: *)
(*chilist={};*)
(*chinoplist={};*)
(*palist={};*)
(*nopalist={};*)
(*Do[*)
(*fitresults=FindMinimum[Re[Chisq[\[Lambda]]],guess,MaxIterations->2000]//Quiet;*)
(*chisqwp=Re[fitresults[[1]]];*)
(*pars=fitresults[[2]];*)
(*chisq=Re[Chisq[0]]/.pars;*)
(*AppendTo[chilist,{\[Lambda],chisqwp}];*)
(*AppendTo[chinoplist,{\[Lambda],chisq}];*)
(*guess=Table[{pars[[i,1]],pars[[i,2]]},{i,1,Length[pars]}];*)
(*kkcount=0;*)
(*Do[If[Abs[pars[[i,2]]]<10^-3,kkcount=kkcount+1],{i,1,Length[guess]}];*)
(*AppendTo[nopalist,{\[Lambda],Length[guess]-4kkcount}];*)
(*AppendTo[palist,{\[Lambda],pars[[;;,2]]}];*)
(*Print[\[Lambda]];,{\[Lambda],0,10,0.5}]*)


(* ::Input:: *)
(**)
(*respalist=Table[{palist[[i,1]],Flatten[Table[palist[[i,2,30+4j]],{j,0,9}]]},{i,1,Length[palist]}];*)
(*respar= Table[{respalist[[i,1]],Abs[respalist[[i,2,j]]]},{j,1,Length[respalist[[1,2]]]},{i,1,Length[respalist]}];*)
(*plot1=Show[ListLogPlot[{chidof,chitestdof},LabelStyle->12,Epilog->Text[Style["(a)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}],Joined->True,PlotRange->{{0,8},All},Frame->True,FrameLabel->{"\[Lambda]","\!\(\*SuperscriptBox[\(\[Chi]\), \(2\)]\)/d.o.f."}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-1,10000,1000}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plot2=Show[ListLogPlot[respar,LabelStyle->12,Epilog->Text[Style["(b)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}],Joined->True,Frame->True,PlotRange->{{0,8},{10,10^-9}},FrameLabel->{"\[Lambda]","x"},PlotStyle->Table[If[Abs[respalist[[Position[bic,Min[bic[[All,2]]]][[1,1]],2,i]]]>10^-3,Darker[Red],Gray],{i,1,Length[respalist[[5,2]]]}]],LogPlot[10^-3,{x,0,8},PlotStyle->{Thick,Black}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-100,10,1}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plot3=Show[ListLogPlot[bic,LabelStyle->12,Epilog->Text[Style["(c)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}],PlotRange->{{0,8},All},Frame->True,Joined->True,FrameLabel->{"\[Lambda]","BIC"}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-1,10000,1000}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plotGrid[{{plot1},{plot2},{plot3}},400,4/3*500]*)


(* ::Title:: *)
(*Penalize the Second Derivative*)


(* ::Input:: *)
(*k[W_,m1_,m2_]:=1/(2*W) (\[Sqrt]((W^2-(m1-m2)^2)*(W^2-(m1+m2)^2)))*)
(*kf[W_]=k[W,mK,mXi];*)
(*ki[W_]=k[W,mK,mP];*)
(*jmax=5/2;*)
(*ons=1;*)
(*onp=1;*)
(*ond=1;*)
(*nopars=6*ons+12*onp+12*ond;*)
(*num=If[nopars==6,1,If[nopars==18,5,9]];*)
(*pars=Flatten[Join[Table[{s[i],\[Alpha][i]},{i,0,num}],Table[{\[Phi][i]},{i,0,num-1}]]];*)
(*S01half[W_]:=ons*((s[0]Exp[-\[Alpha][0]^2*kf[W]^2/\[CapitalLambda]^2]-x[0]Exp[I*ph[0]] \[CapitalGamma][0]/(2(W-M[0]+I \[CapitalGamma][0]/2)))Exp[I*\[Phi][0]])*(kf[W]/\[CapitalLambda])^(0+1/2)*)
(*S11half[W_]:=ons*((s[1]Exp[-\[Alpha][1]^2*kf[W]^2/\[CapitalLambda]^2]-x[1]Exp[I*ph[1]] \[CapitalGamma][1]/(2(W-M[1]+I \[CapitalGamma][1]/2)))Exp[I*\[Phi][1]])*(kf[W]/\[CapitalLambda])^(0+1/2)*)
(*P01half[W_]:=onp*((s[2]Exp[-\[Alpha][2]^2*kf[W]^2/\[CapitalLambda]^2]-x[2]Exp[I*ph[2]] \[CapitalGamma][2]/(2(W-M[2]+I \[CapitalGamma][2]/2)))Exp[I*\[Phi][2]])*(kf[W]/\[CapitalLambda])^(1+1/2)*)
(*P03half[W_]:=onp*((s[3]Exp[-\[Alpha][3]^2*kf[W]^2/\[CapitalLambda]^2]-x[3]Exp[I*ph[3]] \[CapitalGamma][3]/(2(W-M[3]+I \[CapitalGamma][3]/2)))Exp[I*\[Phi][3]])*(kf[W]/\[CapitalLambda])^(1+1/2)*)
(*P11half[W_]:=onp*((s[4]Exp[-\[Alpha][4]^2*kf[W]^2/\[CapitalLambda]^2]-x[4]Exp[I*ph[4]] \[CapitalGamma][4]/(2(W-M[4]+I \[CapitalGamma][4]/2)))Exp[I*\[Phi][4]])*(kf[W]/\[CapitalLambda])^(1+1/2)*)
(*P13half[W_]:=onp*((s[5]Exp[-\[Alpha][5]^2*kf[W]^2/\[CapitalLambda]^2]-x[5]Exp[I*ph[5]] \[CapitalGamma][5]/(2(W-M[5]+I \[CapitalGamma][5]/2)))Exp[I*\[Phi][5]])*(kf[W]/\[CapitalLambda])^(1+1/2)*)
(*D03half[W_]:=ond*((s[6]Exp[-\[Alpha][6]^2*kf[W]^2/\[CapitalLambda]^2]-x[6]Exp[I*ph[6]] \[CapitalGamma][6]/(2(W-M[6]+I \[CapitalGamma][6]/2)))Exp[I*\[Phi][6]])*(kf[W]/\[CapitalLambda])^(2+1/2)*)
(*D05half[W_]:=ond*((s[7]Exp[-\[Alpha][7]^2*kf[W]^2/\[CapitalLambda]^2]-x[7]Exp[I*ph[7]] \[CapitalGamma][7]/(2(W-M[7]+I \[CapitalGamma][7]/2)))Exp[I*\[Phi][7]])*(kf[W]/\[CapitalLambda])^(2+1/2)*)
(*D13half[W_]:=ond*((s[8]Exp[-\[Alpha][8]^2*kf[W]^2/\[CapitalLambda]^2]-x[8]Exp[I*ph[8]] \[CapitalGamma][8]/(2(W-M[8]+I \[CapitalGamma][8]/2)))Exp[I*\[Phi][8]])*(kf[W]/\[CapitalLambda])^(2+1/2)*)
(*D15half[W_]:=ond*((s[9]Exp[-\[Alpha][9]^2*kf[W]^2/\[CapitalLambda]^2]-x[9]Exp[I*ph[9]] \[CapitalGamma][9]/(2(W-M[9]+I \[CapitalGamma][9]/2)))Exp[I*0])*(kf[W]/\[CapitalLambda])^(2+1/2)*)
(*Subscript[\[Tau]0, -1/2]={S01half[W],P03half[W],D05half[W]};*)
(*Subscript[\[Tau]0, +1/2]={P01half[W],D03half[W],0};*)
(*Subscript[\[Tau]1, -1/2]={S11half[W],P13half[W],D15half[W]};*)
(*Subscript[\[Tau]1, +1/2]={P11half[W],D13half[W],0};*)
(*g0[\[Theta]_,W_]=1/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]0, -1/2][[J+1/2]]+Subscript[\[Tau]0, +1/2][[J+1/2]])Cos[\[Theta]/2]+WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]0, -1/2][[J+1/2]]-Subscript[\[Tau]0, +1/2][[J+1/2]])Sin[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*h0[\[Theta]_,W_]=-I/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]0, -1/2][[J+1/2]]+Subscript[\[Tau]0, +1/2][[J+1/2]])Sin[\[Theta]/2]-WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]0, -1/2][[J+1/2]]-Subscript[\[Tau]0, +1/2][[J+1/2]])Cos[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*g1[\[Theta]_,W_]=1/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]1, -1/2][[J+1/2]]+Subscript[\[Tau]1, +1/2][[J+1/2]])Cos[\[Theta]/2]+WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]1, -1/2][[J+1/2]]-Subscript[\[Tau]1, +1/2][[J+1/2]])Sin[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*h1[\[Theta]_,W_]=-I/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]1, -1/2][[J+1/2]]+Subscript[\[Tau]1, +1/2][[J+1/2]])Sin[\[Theta]/2]-WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]1, -1/2][[J+1/2]]-Subscript[\[Tau]1, +1/2][[J+1/2]])Cos[\[Theta]/2]),{J,1/2,jmax,1}];*)
(**)
(**)
(*gre1[\[Theta]_,W_]:=-1/2 g1[\[Theta],W]+1/2 g0[\[Theta],W](*<\[CapitalXi]^-k^+| p K^- *)*)
(*hre1[\[Theta]_,W_]:=-1/2 h1[\[Theta],W]+1/2 h0[\[Theta],W] (*<\[CapitalXi]^-k^+| p K^- *)*)
(**)
(*gre2[\[Theta]_,W_]:=-1/2 g1[\[Theta],W]-1/2 g0[\[Theta],W](*<\[CapitalXi]^0k^0| p K^- *)*)
(*hre2[\[Theta]_,W_]:=-1/2 h1[\[Theta],W]-1/2 h0[\[Theta],W] (*<\[CapitalXi]^0k^0| p K^- *)*)
(**)
(**)
(*d\[Sigma]d\[CapitalOmega]1[W_,\[Theta]_]:=factor*(Conjugate[gre1[\[Theta],W]]gre1[\[Theta],W]+Conjugate[hre1[\[Theta],W]]*hre1[\[Theta],W])*kf[W]/ki[W](*<\[CapitalXi]^-k^+| p K^- *)*)
(*P1[W_,\[Theta]_]:=(2Re[gre1[\[Theta],W]*Conjugate[hre1[\[Theta],W]]])/(Abs[gre1[\[Theta],W]]^2+Abs[hre1[\[Theta],W]]^2)*d\[Sigma]d\[CapitalOmega]1[W,\[Theta]](*<\[CapitalXi]^-k^+| p K^- *)*)
(**)
(**)
(*d\[Sigma]d\[CapitalOmega]2[W_,\[Theta]_]:=factor*(Conjugate[gre2[\[Theta],W]]gre2[\[Theta],W]+Conjugate[hre2[\[Theta],W]]*hre2[\[Theta],W])*kf[W]/ki[W](*<\[CapitalXi]^0k^0| p K^- *)*)
(*P2[W_,\[Theta]_]:=(2Re[gre2[\[Theta],W]*Conjugate[hre2[\[Theta],W]]])/(Abs[gre2[\[Theta],W]]^2+Abs[hre2[\[Theta],W]]^2)*d\[Sigma]d\[CapitalOmega]2[W,\[Theta]](*<\[CapitalXi]^0k^0| p K^- *)*)
(*\[Sigma]1[W_]=factor*1/2*(4Pi)/ki[W]^2 Sum[(2J+1) (Abs[-1/2 (Subscript[\[Tau]1, -1/2][[J+1/2]])+1/2 (Subscript[\[Tau]0, -1/2][[J+1/2]])]^2+ Abs[-1/2 (Subscript[\[Tau]1, 1/2][[J+1/2]])+1/2 (Subscript[\[Tau]0, 1/2][[J+1/2]])]^2),{J,1/2,jmax,1}];*)
(*\[Sigma]2[W_]=factor*1/2*(4Pi)/ki[W]^2 Sum[(2J+1) (Abs[-1/2 (Subscript[\[Tau]1, -1/2][[J+1/2]])-1/2 (Subscript[\[Tau]0, -1/2][[J+1/2]])]^2+ Abs[-1/2 (Subscript[\[Tau]1, 1/2][[J+1/2]])-1/2 (Subscript[\[Tau]0, 1/2][[J+1/2]])]^2),{J,1/2,jmax,1}];*)


(* ::Input:: *)
(*Chisq[\[Lambda]_,S_]:=Sum[(1/Diff2[[i,j,3]])^2*(d\[Sigma]d\[CapitalOmega]2[Diff2Energy[[i]],Diff2[[i,j,1]]]-Diff2[[i,j,2]])^2,{i,1,Length[Diff2]},{j,1,Length[Diff2[[i]]]}]+Sum[(1/Diff1[[i,j,3]])^2*(d\[Sigma]d\[CapitalOmega]1[Diff1Energy[[i]],Diff1[[i,j,1]]]-Diff1[[i,j,2]])^2,{i,1,Length[Diff1]},{j,1,Length[Diff1[[i]]]}]+Sum[(1/Cross1[[i,3]])^2*(\[Sigma]1[Cross1[[i,1]]]-Cross1[[i,2]])^2,{i,1,Length[Cross1]}]+Sum[(1/Cross2[[i,3]])^2*(\[Sigma]2[Cross2[[i,1]]]-Cross2[[i,2]])^2,{i,1,Length[Cross2]}]+Sum[(1/pol1[[i,j,3]])^2*(P1[pol1Energy[[i]],pol1[[i,j,1]]]-pol1[[i,j,2]])^2,{i,1,Length[pol1]},{j,1,Length[pol1[[i]]]}]+Sum[(1/pol2[[i,j,3]])^2*(P2[pol2Energy[[i]],pol2[[i,j,1]]]-pol2[[i,j,2]])^2,{i,1,Length[pol2]},{j,1,Length[pol2[[i]]]}]+(\[Lambda]^5 Sum[((4 x[i]^2 ((2 (3200-M[i]) \[CapitalGamma][i] (122880000-76800 M[i]+12 M[i]^2+5 \[CapitalGamma][i]^2))/(40960000-25600 M[i]+4 M[i]^2+\[CapitalGamma][i]^2)^2+3 ArcTan[(2 (3200-M[i]))/\[CapitalGamma][i]]))/\[CapitalGamma][i]^3-(4 x[i]^2 ((2 (-M[i]+mK+mXi) \[CapitalGamma][i] (12 M[i]^2-24 M[i] (mK+mXi)+12 (mK+mXi)^2+5 \[CapitalGamma][i]^2))/(4 M[i]^2-8 M[i] (mK+mXi)+4 (mK+mXi)^2+\[CapitalGamma][i]^2)^2+3 ArcTan[(2 (-M[i]+mK+mXi))/\[CapitalGamma][i]]))/\[CapitalGamma][i]^3)/(1/2 x[i]^2 \[CapitalGamma][i] ArcTan[(2 (3200-M[i]))/\[CapitalGamma][i]]-1/2 x[i]^2 \[CapitalGamma][i] ArcTan[(2 (-M[i]+mK+mXi))/\[CapitalGamma][i]]),{i,0,9}])+(S*Sum[(10^3/(1+Exp[(\[CapitalGamma][i]-10)/2])),{i,0,9}]);*)


(* ::Input:: *)
(*guess={{s[0],-0.34824198024328584`},{\[Alpha][0],3.763438455711533`},{s[1],-0.07153619899748145`},{\[Alpha][1],-0.5504395877254527`},{s[2],0.20791938959137438`},{\[Alpha][2],1.932359556897292`},{s[3],0.3140263682123946`},{\[Alpha][3],1.4353226934402328`},{s[4],-0.09335240870654254`},{\[Alpha][4],1.2586482592270365`},{s[5],0.19804403841470758`},{\[Alpha][5],1.1543752980111297`},{s[6],0.08564949843750701`},{\[Alpha][6],0.8114266359183674`},{s[7],1.8696909108351594`},{\[Alpha][7],2.38042861587167`},{s[8],1.6784049993618166`},{\[Alpha][8],2.3546081341506007`},{s[9],-0.4910616507553648`},{\[Alpha][9],1.976612736930773`},{\[Phi][0],-1.3759095905974634`},{\[Phi][1],-1.8628696533673115`},{\[Phi][2],-2.4292106595489664`},{\[Phi][3],-3.7601064302536518`},{\[Phi][4],-3.5505168556001405`},{\[Phi][5],-0.6146668029672369`},{\[Phi][6],0.37669927068590553`},{\[Phi][7],-6.818425121493386`},{\[Phi][8],0.6225800989122515`},{x[0],0.5},{\[CapitalGamma][0],100},{M[0],2036.96},{ph[0],-.9},{x[1],.25},{\[CapitalGamma][1],100},{M[1],2000},{ph[1],-1.2},{x[2],.25},{\[CapitalGamma][2],100},{M[2],2000},{ph[2],-1},{x[3],.25},{\[CapitalGamma][3],100},{M[3],2000},{ph[3],-1},{x[4],0.5},{\[CapitalGamma][4],160},{M[4],2191.96},{ph[4],-.8},{x[5],.25},{\[CapitalGamma][5],100},{M[5],2000},{ph[5],-.2131},{x[6],.25},{\[CapitalGamma][6],100},{M[6],2000},{ph[6],-.121},{x[7],0.5},{\[CapitalGamma][7],60},{M[7],2786.962`},{ph[7],-.7},{x[8],.25},{\[CapitalGamma][8],100},{M[8],2000},{ph[8],-1},{x[9],0.5},{\[CapitalGamma][9],81},{M[9],2603.962`},{ph[9],-0.6}};*)


(* ::Input:: *)
(*chilist={};*)
(*chinoplist={};*)
(*palist={};*)
(*nopalist={};*)
(*Do[*)
(*fitresults=FindMinimum[Chisq[\[Lambda],1],guess,MaxIterations->4000];*)
(*pars=fitresults[[2]];*)
(*chisqwp=Re[Chisq[\[Lambda],0]]/.pars;*)
(*chisq=Re[Chisq[0,0]]/.pars;*)
(*AppendTo[chilist,{\[Lambda],chisqwp}];*)
(*AppendTo[chinoplist,{\[Lambda],chisq}];*)
(*guess=Table[{pars[[i,1]],pars[[i,2]]},{i,1,Length[pars]}];*)
(*kkcount=0;*)
(*Do[If[Abs[pars[[i,2]]]<10^-3,kkcount=kkcount+1],{i,1,Length[guess]}];*)
(*AppendTo[nopalist,{\[Lambda],Length[guess]-4kkcount}];*)
(*AppendTo[palist,{\[Lambda],pars[[;;,2]]}];*)
(*Print[\[Lambda]];,{\[Lambda],0,200,5}]*)


(* ::Input:: *)
(*nopalist={};*)
(*Do[*)
(*kcount=0;*)
(*count=0;*)
(*Do[*)
(*count=If[(palist[[i,2,32+4j]]>3200)\[Or](palist[[i,2,32+4j]]<mK+mXi)\[Or](palist[[i,2,31+4j]]>400)\[Or](Abs[palist[[i,2,30+4j]]]<10^-3),4,0];*)
(*kcount=kcount +count;,*)
(*{j,0,9}];*)
(*AppendTo[nopalist,{palist[[i,1]],69-kcount}];,*)
(*{i,1,Length[palist]}]*)
(*nodat=Length[Cross1]+Length[Cross2]+Sum[Length[Diff1[[i]]],{i,1,Length[Diff1]}]+Sum[Length[Diff2[[i]]],{i,1,Length[Diff2]}]+Sum[Length[pol1[[i]]],{i,1,Length[pol1]}]+Sum[Length[pol2[[i]]],{i,1,Length[pol2]}];*)
(*dataPar= Table[{palist[[i,1]],Abs[palist[[i,2,j]]]},{j,1,Length[palist[[1,2]]]},{i,1,Length[palist]}];*)
(*chisq=chinoplist;*)
(*chidof=Table[{chisq[[i,1]],chisq[[i,2]]/(nodat-nopalist[[i,2]])},{i,1,Length[chisq]}];*)
(*aic=Table[{chisq[[i,1]],2nopalist[[i,2]]+nodat*Log[2Pi]+chisq[[i,2]]},{i,1,Length[chisq]}];*)
(*aicc=Table[{chisq[[i,1]],2nopalist[[i,2]]+nodat*Log[2Pi]+chisq[[i,2]]+2*nopalist[[i,2]]*(nopalist[[i,2]]+1)/(nodat-nopalist[[i,2]]-1)},{i,1,Length[chisq]}];*)
(*bic=Table[{chisq[[i,1]],nodat*Log[2Pi]+chisq[[i,2]]+nopalist[[i,2]]Log[nodat]},{i,1,Length[chisq]}];*)
(*chitest=Table[{nopalist[[i,1]],FindRoot[CDF[ChiSquareDistribution[2055-nopalist[[i,2]]],x]==0.95,{x,2000}][[1,2]]},{i,1,Length[chinoplist]}];*)
(*chitestdof=Table[{chitest[[i,1]],chitest[[i,2]]/(nodat-nopalist[[i,2]])},{i,1,Length[chisq]}];*)


(* ::Input:: *)
(**)
(**)
(*respalist=Table[{palist[[i,1]],Flatten[Table[palist[[i,2,31+4j]],{j,0,9}]]},{i,1,Length[palist]}];*)
(*respalist2=Table[{palist[[i,1]],Flatten[Table[palist[[i,2,32+4j]],{j,0,9}]]},{i,1,Length[palist]}];*)
(*respalist3=Table[{palist[[i,1]],Flatten[Table[palist[[i,2,30+4j]],{j,0,9}]]},{i,1,Length[palist]}];*)
(*respar= Table[{respalist[[i,1]],Abs[respalist[[i,2,j]]]},{j,1,Length[respalist[[1,2]]]},{i,1,Length[respalist]}];*)
(*respar2= Table[{respalist2[[i,1]],Abs[respalist2[[i,2,j]]]},{j,1,Length[respalist2[[1,2]]]},{i,1,Length[respalist2]}];*)
(*respar3= Table[{respalist3[[i,1]],Abs[respalist3[[i,2,j]]]},{j,1,Length[respalist3[[1,2]]]},{i,1,Length[respalist3]}];*)
(*nodat=Length[Cross1]+Length[Cross2]+Sum[Length[Diff1[[i]]],{i,1,Length[Diff1]}]+Sum[Length[Diff2[[i]]],{i,1,Length[Diff2]}]+Sum[Length[pol1[[i]]],{i,1,Length[pol1]}]+Sum[Length[pol2[[i]]],{i,1,Length[pol2]}];*)
(*dataPar= Table[{palist[[i,1]],Abs[palist[[i,2,j]]]},{j,1,Length[palist[[1,2]]]},{i,1,Length[palist]}];*)
(*chisq=chinoplist;*)
(*chidof=Table[{chisq[[i,1]],chisq[[i,2]]/(nodat-nopalist[[i,2]])},{i,1,Length[chisq]}];*)
(*aic=Table[{chisq[[i,1]],2nopalist[[i,2]]+nodat*Log[2Pi]+chisq[[i,2]]},{i,1,Length[chisq]}];*)
(*aicc=Table[{chisq[[i,1]],2nopalist[[i,2]]+nodat*Log[2Pi]+chisq[[i,2]]+2*nopalist[[i,2]]*(nopalist[[i,2]]+1)/(nodat-nopalist[[i,2]]-1)},{i,1,Length[chisq]}];*)
(*bic=Table[{chisq[[i,1]],nodat*Log[2Pi]+chisq[[i,2]]+nopalist[[i,2]]Log[nodat]},{i,1,Length[chisq]}];*)
(*chitest=Table[{nopalist[[i,1]],FindRoot[CDF[ChiSquareDistribution[2055-nopalist[[i,2]]],x]==0.95,{x,2000}][[1,2]]},{i,1,Length[chinoplist]}];*)
(*chitestdof=Table[{chitest[[i,1]],chitest[[i,2]]/(nodat-nopalist[[i,2]])},{i,1,Length[chisq]}];*)


(* ::Input:: *)
(*plot1=Show[ListLogPlot[{chidof,chitestdof},LabelStyle->12,Epilog->Text[Style["(a)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}],Joined->True,PlotRange->{{0,100},{.9,3}},Frame->True,FrameLabel->{"\[Lambda]","\!\(\*SuperscriptBox[\(\[Chi]\), \(2\)]\)/d.o.f."}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-1,10000,1000}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plot2=Show[ListPlot[respar,LabelStyle->12,Epilog->Text[Style["(b)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}],Joined->True,Frame->True,PlotRange->{{0,100},{1.08,1480}},FrameLabel->{"\[Lambda]","\[CapitalGamma] [MeV]"},PlotStyle->Table[If[(palist[[11,2,32+4j]]>3200)\[Or](palist[[11,2,32+4j]]<mK+mXi)\[Or](palist[[11,2,31+4j]]>400)\[Or](Abs[palist[[11,2,30+4j]]]<10^-3),Gray,Darker[Red]],{j,0,9}]],Plot[400,{x,0,500},PlotStyle->{Thick,Black}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-1,10000,1000}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plot3=Show[ListPlot[respar2,LabelStyle->12,Epilog->Text[Style["(c)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}],Joined->True,Frame->True,PlotRange->{{0,100},{1111,3333}},FrameLabel->{"\[Lambda]","M [MeV]"},PlotStyle->Table[If[(palist[[11,2,32+4j]]>3200)\[Or](palist[[11,2,32+4j]]<mK+mXi)\[Or](palist[[11,2,31+4j]]>400)\[Or](Abs[palist[[11,2,30+4j]]]<10^-3),Gray,Darker[Red]],{j,0,9}]],Plot[mK+mXi,{x,0,1000},PlotStyle->{Thick,Black}],Plot[3200,{x,0,1000},PlotStyle->{Thick,Black}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-1,10000,1000}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plot4=Show[ListLogPlot[respar3,LabelStyle->12,Epilog->Text[Style["(d)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}],Joined->True,Frame->True,PlotRange->{{0,100},{3*10^-4,9}},FrameLabel->{"\[Lambda]","x"},PlotStyle->Table[If[(palist[[11,2,32+4j]]>3200)\[Or](palist[[11,2,32+4j]]<mK+mXi)\[Or](palist[[11,2,31+4j]]>400)\[Or](Abs[palist[[11,2,30+4j]]]<10^-3),Gray,Darker[Red]],{j,0,9}]],LogPlot[10^-3,{x,0,1000},PlotStyle->{Thick,Black}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-100,1000,1000}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plot5=Show[ListLogPlot[bic,LabelStyle->12,Epilog->Text[Style["(e)",FontSize->12],Scaled[{0.9,0.93}],{-1,0}],PlotRange->{{0,100},{6100,7999}},Frame->True,Joined->True,FrameLabel->{"\[Lambda]","BIC"}],ListPlot[Table[{bic[[Position[bic,Min[bic[[All,2]]]][[1,1]]]][[1]],i},{i,-1,10000,1000}],Joined->True,PlotStyle->{Thick,Black}]];*)
(*plotGrid[{{plot1},{plot2},{plot3},{plot4},{plot5}},400,5/3*500]*)


(* ::Title:: *)
(*K-Fold Cross Validation*)


(* ::Input:: *)
(*guess={{s[0],-0.34824198024328584`},{\[Alpha][0],3.763438455711533`},{s[1],-0.07153619899748145`},{\[Alpha][1],-0.5504395877254527`},{s[2],0.20791938959137438`},{\[Alpha][2],1.932359556897292`},{s[3],0.3140263682123946`},{\[Alpha][3],1.4353226934402328`},{s[4],-0.09335240870654254`},{\[Alpha][4],1.2586482592270365`},{s[5],0.19804403841470758`},{\[Alpha][5],1.1543752980111297`},{s[6],0.08564949843750701`},{\[Alpha][6],0.8114266359183674`},{s[7],1.8696909108351594`},{\[Alpha][7],2.38042861587167`},{s[8],1.6784049993618166`},{\[Alpha][8],2.3546081341506007`},{s[9],-0.4910616507553648`},{\[Alpha][9],1.976612736930773`},{\[Phi][0],-1.3759095905974634`},{\[Phi][1],-1.8628696533673115`},{\[Phi][2],-2.4292106595489664`},{\[Phi][3],-3.7601064302536518`},{\[Phi][4],-3.5505168556001405`},{\[Phi][5],-0.6146668029672369`},{\[Phi][6],0.37669927068590553`},{\[Phi][7],-6.818425121493386`},{\[Phi][8],0.6225800989122515`},{x[0],0.5`},{\[CapitalGamma][0],100},{M[0],2036.962`},{ph[0],-0.9`},{x[1],0.25`},{\[CapitalGamma][1],100},{M[1],2000},{ph[1],-1.2`},{x[2],0.25`},{\[CapitalGamma][2],100},{M[2],2000},{ph[2],-1},{x[3],0.25`},{\[CapitalGamma][3],100},{M[3],2000},{ph[3],-1},{x[4],0.5`},{\[CapitalGamma][4],160},{M[4],2191.96`},{ph[4],-0.8`},{x[5],0.25`},{\[CapitalGamma][5],100},{M[5],2000},{ph[5],-0.2131`},{x[6],0.25`},{\[CapitalGamma][6],100},{M[6],2000},{ph[6],-0.121`},{x[7],0.5`},{\[CapitalGamma][7],60},{M[7],2786.962`},{ph[7],-0.7`},{x[8],0.25`},{\[CapitalGamma][8],100},{M[8],2000},{ph[8],-1},{x[9],0.5`},{\[CapitalGamma][9],200},{M[9],2603.962`},{ph[9],-0.6`}};*)


(* ::Input:: *)
(*chilist={};*)
(*chinoplist={};*)
(*palist={};*)
(*nopalist={};*)
(*k[W_,m1_,m2_]:=1/(2*W) (\[Sqrt]((W^2-(m1-m2)^2)*(W^2-(m1+m2)^2)))*)
(*kf[W_]=k[W,mK,mXi];*)
(*ki[W_]=k[W,mK,mP];*)
(*jmax=5/2;*)
(*ons=1;*)
(*onp=1;*)
(*ond=1;*)
(*nopars=6*ons+12*onp+12*ond;*)
(*num=If[nopars==6,1,If[nopars==18,5,9]];*)
(*pars=Flatten[Join[Table[{s[i],\[Alpha][i]},{i,0,num}],Table[{\[Phi][i]},{i,0,num-1}]]];*)
(*Do[*)
(**)
(*Do[on[i]=If[Abs[guess[[4*i+30,2]]]>10^-3,1,0],{i,0,9}];*)
(*S01half[W_]:=((s[0]Exp[-\[Alpha][0]^2*kf[W]^2/\[CapitalLambda]^2]-on[0]x[0]Exp[I*ph[0]] \[CapitalGamma][0]/(2(W-M[0]+I \[CapitalGamma][0]/2)))Exp[I*\[Phi][0]])*(kf[W]/\[CapitalLambda])^(0+1/2);*)
(*S11half[W_]:=((s[1]Exp[-\[Alpha][1]^2*kf[W]^2/\[CapitalLambda]^2]-on[1]x[1]Exp[I*ph[1]] \[CapitalGamma][1]/(2(W-M[1]+I \[CapitalGamma][1]/2)))Exp[I*\[Phi][1]])*(kf[W]/\[CapitalLambda])^(0+1/2);*)
(*P01half[W_]:=((s[2]Exp[-\[Alpha][2]^2*kf[W]^2/\[CapitalLambda]^2]-on[2]x[2]Exp[I*ph[2]] \[CapitalGamma][2]/(2(W-M[2]+I \[CapitalGamma][2]/2)))Exp[I*\[Phi][2]])*(kf[W]/\[CapitalLambda])^(1+1/2);*)
(*P03half[W_]:=((s[3]Exp[-\[Alpha][3]^2*kf[W]^2/\[CapitalLambda]^2]-on[3]x[3]Exp[I*ph[3]] \[CapitalGamma][3]/(2(W-M[3]+I \[CapitalGamma][3]/2)))Exp[I*\[Phi][3]])*(kf[W]/\[CapitalLambda])^(1+1/2);*)
(*P11half[W_]:=((s[4]Exp[-\[Alpha][4]^2*kf[W]^2/\[CapitalLambda]^2]-on[4]x[4]Exp[I*ph[4]] \[CapitalGamma][4]/(2(W-M[4]+I \[CapitalGamma][4]/2)))Exp[I*\[Phi][4]])*(kf[W]/\[CapitalLambda])^(1+1/2);*)
(*P13half[W_]:=((s[5]Exp[-\[Alpha][5]^2*kf[W]^2/\[CapitalLambda]^2]-on[5]x[5]Exp[I*ph[5]] \[CapitalGamma][5]/(2(W-M[5]+I \[CapitalGamma][5]/2)))Exp[I*\[Phi][5]])*(kf[W]/\[CapitalLambda])^(1+1/2);*)
(*D03half[W_]:=((s[6]Exp[-\[Alpha][6]^2*kf[W]^2/\[CapitalLambda]^2]-on[6]x[6]Exp[I*ph[6]] \[CapitalGamma][6]/(2(W-M[6]+I \[CapitalGamma][6]/2)))Exp[I*\[Phi][6]])*(kf[W]/\[CapitalLambda])^(2+1/2);*)
(*D05half[W_]:=((s[7]Exp[-\[Alpha][7]^2*kf[W]^2/\[CapitalLambda]^2]-on[7]x[7]Exp[I*ph[7]] \[CapitalGamma][7]/(2(W-M[7]+I \[CapitalGamma][7]/2)))Exp[I*\[Phi][7]])*(kf[W]/\[CapitalLambda])^(2+1/2);*)
(*D13half[W_]:=((s[8]Exp[-\[Alpha][8]^2*kf[W]^2/\[CapitalLambda]^2]-on[8]x[8]Exp[I*ph[8]] \[CapitalGamma][8]/(2(W-M[8]+I \[CapitalGamma][8]/2)))Exp[I*\[Phi][8]])*(kf[W]/\[CapitalLambda])^(2+1/2);*)
(*D15half[W_]:=((s[9]Exp[-\[Alpha][9]^2*kf[W]^2/\[CapitalLambda]^2]-on[9]x[9]Exp[I*ph[9]] \[CapitalGamma][9]/(2(W-M[9]+I \[CapitalGamma][9]/2)))Exp[I*0])*(kf[W]/\[CapitalLambda])^(2+1/2);*)
(*Subscript[\[Tau]0, -1/2]={S01half[W],P03half[W],D05half[W]};*)
(*Subscript[\[Tau]0, +1/2]={P01half[W],D03half[W],0};*)
(*Subscript[\[Tau]1, -1/2]={S11half[W],P13half[W],D15half[W]};*)
(*Subscript[\[Tau]1, +1/2]={P11half[W],D13half[W],0};*)
(*g0[\[Theta]_,W_]=1/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]0, -1/2][[J+1/2]]+Subscript[\[Tau]0, +1/2][[J+1/2]])Cos[\[Theta]/2]+WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]0, -1/2][[J+1/2]]-Subscript[\[Tau]0, +1/2][[J+1/2]])Sin[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*h0[\[Theta]_,W_]=-I/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]0, -1/2][[J+1/2]]+Subscript[\[Tau]0, +1/2][[J+1/2]])Sin[\[Theta]/2]-WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]0, -1/2][[J+1/2]]-Subscript[\[Tau]0, +1/2][[J+1/2]])Cos[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*g1[\[Theta]_,W_]=1/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]1, -1/2][[J+1/2]]+Subscript[\[Tau]1, +1/2][[J+1/2]])Cos[\[Theta]/2]+WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]1, -1/2][[J+1/2]]-Subscript[\[Tau]1, +1/2][[J+1/2]])Sin[\[Theta]/2]),{J,1/2,jmax,1}];*)
(*h1[\[Theta]_,W_]=-I/(2Sqrt[kf[W]*ki[W]])*Sum[(2J+1)*(WignerD[{J,1/2,1/2},\[Theta]]*(Subscript[\[Tau]1, -1/2][[J+1/2]]+Subscript[\[Tau]1, +1/2][[J+1/2]])Sin[\[Theta]/2]-WignerD[{J,-1/2,1/2},\[Theta]](Subscript[\[Tau]1, -1/2][[J+1/2]]-Subscript[\[Tau]1, +1/2][[J+1/2]])Cos[\[Theta]/2]),{J,1/2,jmax,1}];*)
(**)
(**)
(*gre1[\[Theta]_,W_]:=-1/2 g1[\[Theta],W]+1/2 g0[\[Theta],W](*<\[CapitalXi]^-k^+| p K^- *);*)
(*hre1[\[Theta]_,W_]:=-1/2 h1[\[Theta],W]+1/2 h0[\[Theta],W] (*<\[CapitalXi]^-k^+| p K^- *);*)
(**)
(*gre2[\[Theta]_,W_]:=-1/2 g1[\[Theta],W]-1/2 g0[\[Theta],W](*<\[CapitalXi]^0k^0| p K^- *);*)
(*hre2[\[Theta]_,W_]:=-1/2 h1[\[Theta],W]-1/2 h0[\[Theta],W] (*<\[CapitalXi]^0k^0| p K^- *);*)
(**)
(**)
(*d\[Sigma]d\[CapitalOmega]1[W_,\[Theta]_]:=factor*(Conjugate[gre1[\[Theta],W]]gre1[\[Theta],W]+Conjugate[hre1[\[Theta],W]]*hre1[\[Theta],W])*kf[W]/ki[W](*<\[CapitalXi]^-k^+| p K^- *);*)
(*P1[W_,\[Theta]_]:=(2Re[gre1[\[Theta],W]*Conjugate[hre1[\[Theta],W]]])/(Abs[gre1[\[Theta],W]]^2+Abs[hre1[\[Theta],W]]^2)*d\[Sigma]d\[CapitalOmega]1[W,\[Theta]](*<\[CapitalXi]^-k^+| p K^- *);*)
(**)
(**)
(*d\[Sigma]d\[CapitalOmega]2[W_,\[Theta]_]:=factor*(Conjugate[gre2[\[Theta],W]]gre2[\[Theta],W]+Conjugate[hre2[\[Theta],W]]*hre2[\[Theta],W])*kf[W]/ki[W](*<\[CapitalXi]^0k^0| p K^- *);*)
(*P2[W_,\[Theta]_]:=(2Re[gre2[\[Theta],W]*Conjugate[hre2[\[Theta],W]]])/(Abs[gre2[\[Theta],W]]^2+Abs[hre2[\[Theta],W]]^2)*d\[Sigma]d\[CapitalOmega]2[W,\[Theta]](*<\[CapitalXi]^0k^0| p K^- *);*)
(*\[Sigma]1[W_]=factor*1/2*(4Pi)/ki[W]^2 Sum[(2J+1) (Abs[-1/2 (Subscript[\[Tau]1, -1/2][[J+1/2]])+1/2 (Subscript[\[Tau]0, -1/2][[J+1/2]])]^2+ Abs[-1/2 (Subscript[\[Tau]1, 1/2][[J+1/2]])+1/2 (Subscript[\[Tau]0, 1/2][[J+1/2]])]^2),{J,1/2,jmax,1}];*)
(*\[Sigma]2[W_]=factor*1/2*(4Pi)/ki[W]^2 Sum[(2J+1) (Abs[-1/2 (Subscript[\[Tau]1, -1/2][[J+1/2]])-1/2 (Subscript[\[Tau]0, -1/2][[J+1/2]])]^2+ Abs[-1/2 (Subscript[\[Tau]1, 1/2][[J+1/2]])-1/2 (Subscript[\[Tau]0, 1/2][[J+1/2]])]^2),{J,1/2,jmax,1}];*)
(*Chisq[\[Lambda]_,data1_,data2_,data3_,data4_,data5_,data6_]:=Sum[(1/data1[[i,j,3]])^2*(d\[Sigma]d\[CapitalOmega]1[Diff1Energy[[i]],data1[[i,j,1]]]-data1[[i,j,2]])^2,{i,1,Length[data1]},{j,1,Length[data1[[i]]]}]+*)
(*Sum[(1/data2[[i,j,3]])^2*(d\[Sigma]d\[CapitalOmega]2[Diff2Energy[[i]],data2[[i,j,1]]]-data2[[i,j,2]])^2,{i,1,Length[data2]},{j,1,Length[data2[[i]]]}]+Sum[(1/data3[[i,j,3]])^2*(P1[pol1Energy[[i]],data3[[i,j,1]]]-data3[[i,j,2]])^2,{i,1,Length[data3]},{j,1,Length[data3[[i]]]}]+Sum[(1/data4[[i,j,3]])^2*(P2[pol2Energy[[i]],data4[[i,j,1]]]-data4[[i,j,2]])^2,{i,1,Length[data4]},{j,1,Length[data4[[i]]]}]+Sum[(1/data5[[i,3]])^2*(\[Sigma]1[data5[[i,1]]]-data5[[i,2]])^2,{i,1,Length[data5]}]+Sum[(1/data6[[i,3]])^2*(\[Sigma]2[data6[[i,1]]]-data6[[i,2]])^2,{i,1,Length[data6]}]++\[Lambda]^4(Abs[x[9]]+Abs[x[8]]+Abs[x[7]]+Abs[x[6]]+Abs[x[5]]+Abs[x[4]]+Abs[x[3]]+Abs[x[2]]+Abs[x[1]]+Abs[x[0]]);*)
(**)
(*fitresults=FindMinimum[Chisq[\[Lambda],Diff1t,Diff2t,pol1t,pol2t,Cross1t,Cross2t],guess,MaxIterations->2000];*)
(*pars=fitresults[[2]];*)
(*chisqwp=Re[Chisq[\[Lambda],Diff1v,Diff2v,pol1v,pol2v,Cross1v,Cross2v]/.pars];*)
(*chisq=Re[Chisq[0,Diff1v,Diff2v,pol1v,pol2v,Cross1v,Cross2v]/.pars];*)
(*AppendTo[chilist,{\[Lambda],chisqwp}];*)
(*AppendTo[chinoplist,{\[Lambda],chisq}];*)
(*guess=Table[{pars[[i,1]],pars[[i,2]]},{i,1,Length[pars]}];*)
(*kkcount=0;*)
(*Do[If[Abs[pars[[i,2]]]<10^-3,kkcount=kkcount+1],{i,1,Length[guess]}];*)
(*AppendTo[nopalist,{\[Lambda],Length[guess]-4kkcount}];*)
(*AppendTo[palist,{\[Lambda],pars[[;;,2]]}];*)
(*Print[\[Lambda]];,{\[Lambda],0,10,0.5}]*)


(* ::Input:: *)
(*ListLogPlot[chinoplist,LabelStyle->12,Joined->True,PlotRange->{{0,8},{680,701}},Frame->True,FrameLabel->{"\[Lambda]","Validation \!\(\*SuperscriptBox[\(\[Chi]\), \(2\)]\)"}]*)
